<!-- 작성자: 윤혜진, 작성일: 2020.11.17 -->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일괄등록</title>

    <!-- My CSS -->
	<link rel="stylesheet" href="/dadam_edu/css/reset.css">

    <style>
        .goods_excel_wrap {
            width: 96%;
            padding: 10px;
            border: 1px solid #000;
            margin: 2%;
        }
        #uploadForm {
            width: 100%;
            height: 420px;
            text-align: center;
        }
        #uploadForm .table {
            width: 100%;
            height: 100%;
        }
        .filebox {
            width: 100%;
            text-align: center;
        }
        .filebox label { 
            display: inline-block;
            width: 250px;
            height: 30px;
            line-height: 30px;
            background-color: #0af;
            color: #fff;
            text-align: center;
            cursor: pointer;
        }
        .filebox input[type="file"] { 
            /* 파일 필드 숨기기 */ 
            position: absolute; 
            width: 1px; 
            height: 1px; 
            padding: 0; 
            margin: -1px; 
            overflow: hidden; 
            clip:rect(0,0,0,0); 
            border: 0; 
        }
        .table, 
        .table tr,
        #dropZone {
            border: 0;
        }
    </style>

</head>
<body>

    <div class="goods_excel_wrap">
        <form name="uploadForm" id="uploadForm" enctype="multipart/form-data" method="post">
            <table class="table">
                <tbody id="fileTableTbody">
                    <tr>
                        <td id="dropZone">
                            파일을 여기에 놓으세요.<br>
                            (Xlsx. Xls.)
                        </td>
                    </tr>
                </tbody>
            </table>
        </form>
            
        <div class="filebox">
            <label for="excel_file">내 컴퓨터에서 파일선택</label>
            <input type="file" accept=".xls,.xlsx" id="excel_file"/>
        </div>
    </div>

    <!-- jquery JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- <script src="/dadam_edu/js/excel.js"></script> -->
    <script>
        $(function(){

            var fileIndex = 0;              // 파일 리스트 번호
            var totalFileSize = 0;          // 등록할 전체 파일 사이즈
            var fileList = new Array();     // 파일 리스트
            var fileSizeList = new Array(); // 파일 사이즈 리스트
            var uploadSize = 50;            // 등록 가능한 파일 사이즈 MB
            var maxUploadSize = 500;        // 등록 가능한 총 파일 사이즈 MB

            fileDropDown(); // 파일 드롭 다운

            // 파일 드롭 다운
            function fileDropDown(){
                var dropZone = $("#dropZone");
                
                //Drag기능 
                dropZone.on('dragenter',function(e){
                    e.stopPropagation();
                    e.preventDefault();
                    // 드롭다운 영역 css
                    dropZone.css('background-color','#ACFCFF');
                });
                dropZone.on('dragleave',function(e){
                    e.stopPropagation();
                    e.preventDefault();
                    // 드롭다운 영역 css
                    dropZone.css('background-color','#FFFFFF');
                });
                dropZone.on('dragover',function(e){
                    e.stopPropagation();
                    e.preventDefault();
                    // 드롭다운 영역 css
                    dropZone.css('background-color','#ACFCFF');
                });
                dropZone.on('drop',function(e){
                    e.stopPropagation();
                    e.preventDefault();
                    // 드롭다운 영역 css
                    dropZone.css('background-color','#FFFFFF');
                    
                    var files = e.originalEvent.dataTransfer.files;
                    if(files != null){
                        if(files.length < 1){
                            alert("폴더 업로드 불가");
                            return;
                        }
                        selectFile(files)
                    } else {
                        alert("ERROR");
                    }
                });
            }

            // 파일 선택시
            function selectFile(files){
                // 다중파일 등록
                if(files != null){ // 파일이 있는지 체크
                    // for(var i = 0; i < files.length; i++){
                        // 파일 이름
                        // var fileName = files[i].name;
                        var fileName = files[0].name;
                        var fileNameArr = fileName.split("\.");
                        // 확장자
                        var ext = fileNameArr[fileNameArr.length - 1];
                        // 파일 사이즈(단위 :MB)
                        var fileSize = files[0].size / 1024 / 1024;
                        
                        if($.inArray(ext, ['xlsx', 'xls']) >= 0){   // 확장자가 배열에 없으면 -1을 반환
                            // 확장자 체크
                            alert("등록 불가 확장자");
                            // break;
                        } else if (fileSize > uploadSize){
                            // 파일 사이즈 체크
                            alert("용량 초과\n업로드 가능 용량 : " + uploadSize + " MB");
                            // break;
                        } else {
                            // 전체 파일 사이즈
                            // totalFileSize += fileSize;
                            
                            // 파일 배열에 넣기
                            // fileList[fileIndex] = files[0];
                            
                            // 파일 사이즈 배열에 넣기
                            // fileSizeList[fileIndex] = fileSize;

                            // 업로드 파일 목록 생성
                            // addFileList(fileIndex, fileName, fileSize);
                            uploadFile(files[0]);

                            // 파일 번호 증가
                            // fileIndex++;
                        }
                    // }
                } else {
                    alert("ERROR");
                }
            }

            // 업로드 파일 목록 생성
            function addFileList(fIndex, fileName, fileSize){
                var html = "";
                html += "<tr id='fileTr_" + fIndex + "'>";
                html += "    <td class='left' >";
                html +=         fileName + " / " + fileSize + "MB "  + "<a href='#' onclick='deleteFile(" + fIndex + "); return false;' class='btn small bg_02'>삭제</a>"
                html += "    </td>"
                html += "</tr>"

                $('#fileTableTbody').append(html);
            }


            // 업로드 파일 삭제
            function deleteFile(fIndex){
                // 전체 파일 사이즈 수정
                totalFileSize -= fileSizeList[fIndex];
                
                // 파일 배열에서 삭제
                delete fileList[fIndex];
                
                // 파일 사이즈 배열 삭제
                delete fileSizeList[fIndex];
                
                // 업로드 파일 테이블 목록에서 삭제
                $("#fileTr_" + fIndex).remove();
            }

            // 파일 등록
            // function uploadFile(){
            //     // 등록할 파일 리스트
            //     var uploadFileList = Object.keys(fileList);

            //     // 파일이 있는지 체크
            //     if(uploadFileList.length == 0){
            //         // 파일등록 경고창
            //         alert("파일이 없습니다.");
            //         return;
            //     }
                
            //     // 용량을 500MB를 넘을 경우 업로드 불가
            //     if(totalFileSize > maxUploadSize){
            //         // 파일 사이즈 초과 경고창
            //         alert("총 용량 초과\n총 업로드 가능 용량 : " + maxUploadSize + " MB");
            //         return;
            //     }
                    
            //     if(confirm("등록 하시겠습니까?")){
            //         // 등록할 파일 리스트를 formData로 데이터 입력
            //         var form = $('#uploadForm');
            //         var formData = new FormData(form);
            //         for(var i = 0; i < uploadFileList.length; i++){
            //             formData.append('files', fileList[uploadFileList[i]]);
            //         }
                    
            //         $.ajax({
            //             url:"업로드 경로",
            //             data:formData,
            //             type:'POST',
            //             enctype:'multipart/form-data',
            //             processData:false,
            //             contentType:false,
            //             dataType:'json',
            //             cache:false,
            //             success:function(result){
            //                 if(result.data.length > 0){
            //                     alert("성공");
            //                     location.reload();
            //                 }else{
            //                     alert("실패");
            //                     location.reload();
            //                 }
            //             }
            //         });
            //     }
            // }

            // 파일 등록
            function uploadFile(file){
                if(confirm("등록 하시겠습니까?")){
                    
                }
            }
        });
    </script>
</body>
</html>